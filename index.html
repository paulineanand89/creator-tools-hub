<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Free AdSense Technical Readiness & SEO Pre-Checker</title>
  <style>
    body { font-family: Inter, Arial, sans-serif; background:#f5f7fa; margin:0; }
    header { background:#2d3748; color:#fff; padding:15px 30px; font-size:18px; font-weight:600; }
    .container { max-width:900px; margin:40px auto; background:#fff; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:30px; }
    h1 { font-size:24px; margin-bottom:10px; color:#2d3748; }
    textarea, input[type="text"] { width:100%; padding:12px; margin:10px 0; border:1px solid #cbd5e0; border-radius:6px; font-size:14px; }
    button { background:#3182ce; color:#fff; border:none; padding:12px 20px; border-radius:6px; font-size:14px; cursor:pointer; transition:background 0.2s; }
    button:hover { background:#2b6cb0; }
    .section { margin-top:20px; }
    .section h3 { margin-bottom:8px; color:#2d3748; }
    .item { margin-left:20px; margin-bottom:4px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:10px; font-size:12px; font-weight:600; margin-left:10px; }
    .success { background:#c6f6d5; color:#22543d; }
    .error { background:#fed7d7; color:#742a2a; }
    .score { margin-top:20px; font-size:18px; font-weight:600; color:#2d3748; }
    .verdict { font-size:16px; font-weight:600; margin-top:10px; }
    .low { color:green; }
    .medium { color:orange; }
    .high { color:red; }
    .footer { margin-top:30px; padding-top:15px; border-top:1px solid #e2e8f0; font-size:13px; color:#4a5568; }
  </style>
</head>
<body>
  <header>Free AdSense Technical Readiness & SEO Pre-Checker</header>
  <div class="container">
    <h1>Technical Audit & Eligibility Indicators</h1>
    <p>Paste HTML or enter a URL below:</p>
    <textarea id="htmlInput" rows="8" placeholder="Paste full HTML here..."></textarea>
    <input type="text" id="urlInput" placeholder="Or enter a full URL (https://...)">
    <button onclick="runChecker()">Run Pre-Check</button>
    <div id="output"></div>
  </div>

  <script>
    async function fetchHtml(url){
      try {
        const endpoint = "https://misty-credit-b188.paulineanand89.workers.dev/?url=" + encodeURIComponent(url);
        const res = await fetch(endpoint);
        if(!res.ok) return null;
        return await res.text();
      } catch(e) { return null; }
    }

    // Extended proxy logic: crawl common policy pages
    async function checkPolicyPages(baseUrl){
      const paths = {
        "Privacy Policy": ["/privacy-policy","/privacy"],
        "About page": ["/about"],
        "Contact page": ["/contact"],
        "Terms & Disclaimer": ["/terms","/disclaimer"]
      };
      const results = {};
      for(const label in paths){
        results[label] = false;
        for(const path of paths[label]){
          try {
            const endpoint = "https://misty-credit-b188.paulineanand89.workers.dev/?url=" + encodeURIComponent(baseUrl + path);
            const res = await fetch(endpoint);
            if(res.ok){
              const html = await res.text();
              const lower = html.toLowerCase();
              if(lower.includes("privacy") || lower.includes("about") || lower.includes("contact") || lower.includes("terms") || lower.includes("disclaimer")){
                results[label] = true;
                break; // stop once found
              }
            }
          } catch(e){ /* ignore */ }
        }
      }
      return results;
    }

    async function runChecker(){
      const htmlBox = document.getElementById("htmlInput");
      const urlBox = document.getElementById("urlInput");
      const out = document.getElementById("output");
      out.innerHTML = "<p>Checking...</p>";

      let html = htmlBox.value.trim();
      const url = urlBox.value.trim();

      if(!html && url){
        html = await fetchHtml(url);
        if(!html){
          out.innerHTML = "<p style='color:red'>Could not fetch this URL.</p>";
          return;
        }
      }
      if(!html || !url){
        out.innerHTML = "<p style='color:red'>Please paste HTML or enter a valid URL.</p>";
        return;
      }

      const lowerHtml = html.toLowerCase();
      const bodyText = html.replace(/<[^>]*>/g," ").trim();
      const wordCount = bodyText.split(/\s+/).length;

      // --- Checks grouped ---
      const technical = {
        "HTTPS": url.startsWith("https://"),
        "robots.txt": true,
        "ads.txt": lowerHtml.includes("google.com"),
        "canonical": html.includes("rel=\"canonical\"")
      };

      const seo = {
        "Title optimization": html.includes("<title>"),
        "Meta description": html.includes("name=\"description\""),
        "Header tags": html.includes("<h1")||html.includes("<h2"),
        "Content depth": wordCount>=800
      };

      // Crawl policy pages (await results!)
      const policyResults = await checkPolicyPages(url);
      const policy = {
        "Privacy Policy": policyResults["Privacy Policy"],
        "About page": policyResults["About page"],
        "Contact page": policyResults["Contact page"],
        "Terms & Disclaimer": policyResults["Terms & Disclaimer"],
        "Indexed on Google": true // placeholder
      };

      // --- Scoring ---
      let score = 0;
      let maxScore = 100;
      const weights = {technical:20, seo:25, policy:30};

      function calcScore(group, weight){
        const passed = Object.values(group).filter(v=>v).length;
        const total = Object.keys(group).length;
        return Math.round((passed/total)*weight);
      }

      const techScore = calcScore(technical, weights.technical);
      const seoScore = calcScore(seo, weights.seo);
      const policyScore = calcScore(policy, weights.policy);

      score += techScore + seoScore + policyScore + 25; // performance placeholder

      // Hard rules
      if(!policy["Privacy Policy"]) maxScore = Math.min(maxScore,60);
      if(!technical["HTTPS"]) maxScore = Math.min(maxScore,50);
      if(!seo["Content depth"]) maxScore = Math.min(maxScore,55);
      if(score>maxScore) score=maxScore;

      // Verdict
      let verdictClass="low", verdictText="ðŸŸ¢ Low Approval Risk";
      if(score<60){ verdictClass="high"; verdictText="ðŸ”´ High Risk"; }
      else if(score<80){ verdictClass="medium"; verdictText="ðŸŸ¡ Medium Risk"; }

      // --- Output ---
      out.innerHTML = "";

      function renderSection(title, group, percent){
        out.innerHTML += `<div class="section"><h3>â–¸ ${title} (${percent}%)</h3>`;
        for(const key in group){
          const ok = group[key];
          out.innerHTML += `<div class="item">${key}<span class="badge ${ok?"success":"error"}">${ok?"Pass":"Fail"}</span></div>`;
        }
        out.innerHTML += `</div>`;
      }

      renderSection("Technical Check", technical, techScore);
      renderSection("SEO Check", seo, seoScore);
      renderSection("Policy Compliance", policy, policyScore);

      out.innerHTML += `<div class="score">â–¸ Final Score: ${score}/100</div>`;
      out.innerHTML += `<div class="verdict ${verdictClass}">Verdict badge: ${verdictText}</div>`;

      // Disclaimer + Branding
      const today = new Date().toLocaleDateString();
      out.innerHTML += `
        <div class="footer">
          <p><strong>Disclaimer:</strong> This pre-check estimates AdSense eligibility based on technical and content factors. It does not
