<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Free AdSense Technical Readiness & SEO Pre-Checker</title>
  <style>
    body { font-family: Inter, Arial, sans-serif; background:#f5f7fa; margin:0; }
    header { background:#2d3748; color:#fff; padding:15px 30px; font-size:18px; font-weight:600; }
    .container { max-width:900px; margin:40px auto; background:#fff; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:30px; }
    h1 { font-size:24px; margin-bottom:10px; color:#2d3748; }
    textarea, input[type="text"] { width:100%; padding:12px; margin:10px 0; border:1px solid #cbd5e0; border-radius:6px; font-size:14px; }
    button { background:#3182ce; color:#fff; border:none; padding:12px 20px; border-radius:6px; font-size:14px; cursor:pointer; transition:background 0.2s; }
    button:hover { background:#2b6cb0; }
    .progress { background:#edf2f7; border-radius:6px; overflow:hidden; margin:10px 0; height:14px; }
    .bar { height:14px; background:#ccc; }
    .badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:12px; font-weight:600; margin-left:10px; }
    .success { background:#c6f6d5; color:#22543d; }
    .error { background:#fed7d7; color:#742a2a; }
    .score { margin-top:20px; font-size:18px; font-weight:600; color:#2d3748; }
    .verdict { font-size:16px; font-weight:600; margin-top:10px; }
  </style>
</head>
<body>
  <header>Free AdSense Technical Readiness & SEO Pre-Checker</header>
  <div class="container">
    <h1>Technical Audit & Eligibility Indicators</h1>
    <p>Paste HTML or enter a URL below:</p>
    <textarea id="htmlInput" rows="8" placeholder="Paste full HTML here..."></textarea>
    <input type="text" id="urlInput" placeholder="Or enter a full URL (https://...)">
    <button onclick="runChecker()">Run Pre-Check</button>
    <div id="output"></div>
  </div>

<script>
// Proxy fetch
async function fetchHtml(url){
  try {
    const endpoint = "https://misty-credit-b188.paulineanand89.workers.dev/?url=" + encodeURIComponent(url);
    const res = await fetch(endpoint);
    if(!res.ok) return null;
    return await res.text();
  } catch(e){ console.error("fetchHtml error", e); return null; }
}

// Strict trust page existence check
async function checkPolicyPages(baseUrl, homepageHtml){
  const paths = {
    "Privacy Policy": ["/privacy-policy","/privacy"],
    "About Page": ["/about","/about-us"],
    "Contact Page": ["/contact","/contact-us"],
    "Terms / Disclaimer": ["/terms","/disclaimer"]
  };
  const results = {};
  for(const label in paths){
    results[label] = false;
    for(const path of paths[label]){
      let fullUrl = baseUrl.replace(/\/$/, "") + path;
      try {
        const endpoint = "https://misty-credit-b188.paulineanand89.workers.dev/?url=" + encodeURIComponent(fullUrl);
        const res = await fetch(endpoint);
        if(res.ok){
          const html = await res.text();
          if(html.trim() === homepageHtml.trim()) continue;
          const text = html.replace(/<[^>]*>/g," ").trim();
          const wordCount = text.split(/\s+/).length;
          const keyword = label.toLowerCase().split(" ")[0];
          const inTitleOrHeading = new RegExp(`<title[^>]*>.*${keyword}.*</title>`,"i").test(html) ||
                                   new RegExp(`<h[12][^>]*>.*${keyword}.*</h[12]>`,"i").test(html);
          if(wordCount > 100 && inTitleOrHeading){
            results[label] = true;
            break;
          }
        }
      } catch(e){ console.error("Policy check failed", label, e); }
    }
  }
  return results;
}

// =================================================================
// Enhanced AdSense Checks Module
// =================================================================
const EnhancedAdsenseChecks = {
  async checkAdsTxt(baseUrl, fetchProxy) {
    const domain = baseUrl.replace(/\/$/, "");
    const adsTxtUrl = domain + "/ads.txt";
    try {
      const content = await fetchProxy(adsTxtUrl);
      if (!content) return false;
      return /google\.com,\s*pub-\d{16}/i.test(content);
    } catch(e){ return false; }
  },
  checkStrictH1(html) {
    const h1Matches = html.match(/<h1[^>]*>.*?<\/h1>/gi);
    return h1Matches && h1Matches.length === 1;
  },
  checkImageAltText(html) {
    const imgMatches = html.match(/<img[^>]*>/gi);
    if (!imgMatches || imgMatches.length === 0) return true;
    let altCount = 0;
    imgMatches.forEach(imgTag => {
      if (/<img[^>]*alt\s*=\s*(['"])(?!\s*\1).*?\1/i.test(imgTag)) {
        altCount++;
      }
    });
    const coverage = altCount / imgMatches.length;
    return coverage >= 0.90;
  },
  checkMetaDescriptionContent(html) {
    const metaMatch = html.match(/<meta\s+name=["']description["']\s+content=["'](.*?)["']\s*\/?>/i);
    if (!metaMatch || !metaMatch[1]) return false;
    const content = metaMatch[1].trim();
    const length = content.length;
    return length >= 50 && length <= 160;
  }
};

async function runChecker(){
  const htmlBox = document.getElementById("htmlInput");
  const urlBox = document.getElementById("urlInput");
  const out = document.getElementById("output");
  out.innerHTML = "<p>Checking...</p>";

  let html = htmlBox.value.trim();
  const url = urlBox.value.trim();

  if(!html && url){
    html = await fetchHtml(url);
    if(!html){
      out.innerHTML = "<p style='color:red'>Could not fetch this URL.</p>";
      return;
    }
  }
  if(!html || !url){
    out.innerHTML = "<p style='color:red'>Please paste HTML or enter a valid URL.</p>";
    return;
  }

  const checks = { trust:[], content:[], seo:[], technical:[], performance:[] };

  // Trust pages
  const policyResults = await checkPolicyPages(url, html);
  checks.trust.push({label:"Privacy Policy", ok: policyResults["Privacy Policy"]});
  checks.trust.push({label:"About Page", ok: policyResults["About Page"]});
  checks.trust.push({label:"Contact Page", ok: policyResults["Contact Page"]});
  checks.trust.push({label:"Terms / Disclaimer", ok: policyResults["Terms / Disclaimer"]});

  // Content
  const bodyText = html.replace(/<[^>]*>/g," ").trim();
  const wordCount = bodyText.split(/\s+/).length;
  checks.content.push({label:"Word Count ≥ 800", ok: wordCount>=800});
  checks.content.push({label:"Has Headers", ok: html.includes("<h1")||html.includes("<h2")});
  checks.content.push({label:"Image Alt Text Coverage ≥90%", ok: EnhancedAdsenseChecks.checkImageAltText(html)});

  // SEO
  checks.seo.push({label:"Title Tag", ok: html.includes("<title>")});
  checks.seo.push({label:"Meta Description", ok: html.includes("name=\"description\"")});
  checks.seo.push({label:"Canonical Tag", ok: html.includes("rel=\"canonical\"")});
  checks.seo.push({label:"Strict Single H1", ok: EnhancedAdsenseChecks.checkStrictH1(html)});
  checks.seo.push({label:"Meta Description Length 50–160 chars", ok: EnhancedAdsenseChecks.checkMetaDescriptionContent(html)});

  // Technical
  checks.technical.push({label:"HTTPS", ok: url.startsWith("https://")});
  checks.technical.push({label:"Viewport Meta", ok: html.includes("viewport")});
  checks.technical.push({label:"ads.txt Valid Format", ok
